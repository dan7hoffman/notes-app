<div class="task-list-container">
  <div class="filter">
    <label for="statusFilter">Filter by Status:</label>
    <select id="statusFilter" [(ngModel)]="statusFilter">
      <option value="">All</option>
      <option value="pending">Pending</option>
      <option value="in-progress">In Progress</option>
      <option value="completed">Completed</option>
    </select>
  </div>
  <div class="task">
    @if (tasks().length === 0) {
    <p>No tasks available</p>
    } @else {
    <ul>
      @for (task of tasks(); track task.id) {
      <li class="task-item">
        <h3>Title: {{ task.title }}</h3>
        <p>Content: {{ task.content }}</p>
        <small>Status: {{ task.status }}</small>
        <br />
        <small>Tags: {{ formatValue(task.tags) }}</small>
        <br />
        <small>Priority: {{ task.priority }}</small>
        <br />
        <small>Created At: {{ formatDate(task.createdAt) }}</small>
        <br />
        <small>Last Modified At: {{ formatDate(task.lastModifiedAt) }}</small>
        <br />
        <small>Recent Edit: {{ getMostRecentChange(task.history) }}</small>
        <br />
        <small>Deletion At: {{ formatDate(task.deletionAt) }}</small>
        <br />
        <small>Deleted: {{ task.deleted }}</small>
        <br />
        <small>
          <div *ngIf="task.history?.length">
            <h4>History:</h4>
            <ul *ngIf="task.history?.length">
              <li *ngFor="let entry of task.history; let i = index">
                <strong>{{ formatDate(entry.modifiedAt) }}:</strong>
                <ul>
                  <li *ngFor="let change of getChanges(entry.changes)">
                    {{ change.key }}:
                    <span class="old"
                      >"{{ formatValue(change.oldValue) || "—" }}"</span
                    >
                    →
                    <span class="new"
                      >"{{ formatValue(change.newValue) || "—" }}"</span
                    >
                  </li>
                </ul>
                <button (click)="revertTaskChanges(task.id, i)">
                  Revert to this state
                </button>
              </li>
            </ul>
          </div>
        </small>
        <br />
        <div class="button-group">
          @if (task.status === TaskStatus.Pending) {
          <button (click)="startTask(task.id)">Start</button>
          } @if (task.status === TaskStatus.InProgress) {
          <button (click)="pauseTask(task.id)">Pause</button>
          } @if (task.status !== TaskStatus.Completed) {
          <button (click)="completeTask(task.id)">Complete</button>
          }
        </div>
        <div class="button-group">
          @if (!task.deleted) {
          <button (click)="editTask(task.id)">Edit</button>
          }
        </div>
        <div class="button-group destructive-actions">
          @if (!task.deleted) {
          <button (click)="softDeleteTask(task.id)">Soft Delete</button>
          } @else {
          <button (click)="undoSoftDeleteTask(task.id)">
            Undo Soft Delete
          </button>
          }
          <button (click)="deleteTask(task.id)">Delete</button>
        </div>
      </li>
      }
    </ul>
    }
  </div>
</div>
